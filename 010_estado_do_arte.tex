\chapter[Estado do arte]{Estado do Arte\label{estado_do_arte}}

Neste capítulo explicarase como funciona a internacionalización e localizacion con GNU Gettext. Ademais analizaremos as diferentes alternativas que existen no mercado como ferramentas de asistencia a tradución e as caracteristicas que cada unha incorpora. O final faremos un resumo das características que empregan os programas CAT\footnote{Computer Assisted Translation}.

\section{Internacionalización e localización con GNU Gettext}
Gettext é un sistema para a internacionalización e localización amplamente usado en entornos UNIX. Conta con varías implementacións, sendo a primira de Sun Microsystems no ano 1990. A implementación máis usada é a que GNU liberou no ano 1995. Pese ser unha solución antiga, é a día de hoxe a mellor que se pode atopar no mercado.

Para internacionalizar un programa con GNU Gettext non empregaremos as cadeas de texto directamente como podería ser no seguinte program de exemplo:

\begin{lstlisting}[language=C,label=some-code,caption=helloworld.c (Sen Internacionalizar)]
#include <stdio.h>

int
main ()
{
    printf ("Hello World!");
}
\end{lstlisting}

En lugar diso chamaremos a unha función especial que proporciona Gettext de nome \lstinline{gettext()} pero que é máis empregada a través do seu alias \lstinline{_()}. Ademais configuraremos o programa para que colla a tradución do idioma que queiramos. Desta forma o programa anterior quedaría:

\begin{lstlisting}[language=C,label=some-code,caption=helloworld.c]
#include <stdio.h>
#include <locale.h>
#include <libintl.h>

#define _(str) gettext(str)

#define

int
main ()
{
    setlocale (LC_ALL, "");
    bindtextdomain ("helloworld", "/usr/local/share/locale");
    textdomain ("helloworld");

    printf (_("Hello World!"));
}
\end{lstlisting}

A función \lstinline{gettext()} é a encargada de substituir a cadea orixinal pola tradución. Non obstante vemos que debemos configurar algunhas cousas antes de poder chamar á función.

En primeiro lugar debemos establecer a linguaxe que queremos empregar no programa. Para iso usamos a función \lstinline{setlocale()}. O primeiro argumento da función determina que parte do locale actual queremos modificar. Entre outras podemos atopar:

\begin{itemize}
    \item \textbf{LC\_ALL.} Queremos cambiar todo.
    \item \textbf{LC\_ADDRESS.} Queremos cambiar a forma de formatear os enderezos.
    \item \textbf{LC\_MESSAGES.} Os mensaxes do programa.
    \item \textbf{LC\_NUMERIC.} O formateado das cantidades non monetaias
    \item \textbf{LC\_TIME.} O formateado de datas e horas.
\end{itemize}

Por ultimo especificamos o código de idioma ou no caso de empregar a cadea baleira empregamos os valores das variables de entorno.

Os códigos de idioma empregan a normativa ISO 639 polo que son da forma $$language[\_territory][.codeset][@modifier]$$ Por exemplo o código do galego empregando codificación UTF-8 é \lstinline{gl_ES.UTF-8}.

Ademais debemos indicarlle o programa onde ten que atopar as traducións. Para iso empregamos a función \lstinline{bindtextdomain()} que liga un nome de dominio a unha ruta dentro do sistema e a función \lstinline{textdomain()} que lle indica o programa cal é o nome de dominio que debe empregar. Un dominio é un conxunto de cadeas que se empregan nunha parte determinada dun programa. Cada dominio debe ter un nome de dominio único dentro dun programa.

Con estes parametros Gettext xa é capaz de atopar as traducións que no caso do programa anterior atoparíanse en \emph{/usr/local/share/locale/gl/LC\_MESSAGES/helloworld.mo}.

Unha vez que internacionalizamos o nosos programa debemos traducir as cadeas. Pero para traducir as cadeas debemos extraelas antes do código fonte. Para iso empregaremos a utilidade \emph{xgettext}. Empregando as opcións adecuadas obtemos o seguinte ficheiro:

\begin{lstlisting}[label=some-code,caption=helloworld.pot]
# SOME DESCRIPTIVE TITLE.
# Copyright (C) YEAR THE PACKAGE'S COPYRIGHT HOLDER
# This file is distributed under the same license as the PACKAGE package.
# FIRST AUTHOR <EMAIL@ADDRESS>, YEAR.
#
#, fuzzy
msgid ""
msgstr ""
"Project-Id-Version: PACKAGE VERSION\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2014-11-12 19:24+0100\n"
"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n"
"Last-Translator: FULL NAME <EMAIL@ADDRESS>\n"
"Language-Team: LANGUAGE <LL@li.org>\n"
"Language: \n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=CHARSET\n"
"Content-Transfer-Encoding: 8bit\n"

#: helloworld.c:14
#, c-format
msgid "Hello World!"
msgstr ""
\end{lstlisting}

Os ficheiros Gettext coa extensión \emph{POT} trátanse de plantillas xenéricas para todos os idiomas. Para obter o arquivo especifico para o noso idioma debemos empregar a ferramenta \emph{msginit} con esta ferramenta obteremos un ficheiro similar a este:

\begin{lstlisting}[label=some-code,caption=helloworld.po (Sen Traducir)]
# Galician translations for HELLOWORLD package.
# Copyright (C) 2014 THE HELLOWORLD COPYRIGHT HOLDER
# This file is distributed under the same license as the ch package.
# Marcos Chavarría Teijeiro <chavarria1991@gmail.com>, 2014.
#
msgid ""
msgstr ""
"Project-Id-Version: ch 01\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2014-11-12 19:24+0100\n"
"PO-Revision-Date: 2014-11-12 19:54+0100\n"
"Last-Translator: Marcos Chavarría Teijeiro <chavarria1991@gmail.com>\n"
"Language-Team: Galician\n"
"Language: gl_ES\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=ISO-8859-1\n"
"Content-Transfer-Encoding: 8bit\n"

#: helloworld.c:14
#, c-format
msgid "Hello World!"
msgstr ""
\end{lstlisting}

Desta forma obtemos un ficheiro Gettext PO que é o archivo que temos que editar. Traducindo o arquivo obtemos algo como isto:

\begin{lstlisting}[label=lst:translated_example,caption=helloworld.po (Traducido)]
# Galician translations for HELLOWORLD package.
# Copyright (C) 2014 THE HELLOWORLD COPYRIGHT HOLDER
# This file is distributed under the same license as the HELLOWORLD package.
# Marcos Chavarría Teijeiro <chavarria1991@gmail.com>, 2014.
#
msgid ""
msgstr ""
"Project-Id-Version: HELLOWORLD 1.0\n"
"Report-Msgid-Bugs-To: \n"
"POT-Creation-Date: 2014-11-12 19:24+0100\n"
"PO-Revision-Date: 2014-11-12 19:54+0100\n"
"Last-Translator: Marcos Chavarría Teijeiro <chavarria1991@gmail.com>\n"
"Language-Team: Galician\n"
"Language: gl_ES\n"
"MIME-Version: 1.0\n"
"Content-Type: text/plain; charset=ISO-8859-1\n"
"Content-Transfer-Encoding: 8bit\n"

#: helloworld.c:14
#, c-format
msgid "Hello World!"
msgstr "Ola Mundo!"
\end{lstlisting}

Antes de poder empregar o ficheiro no noso programa temos que compilalo. Para iso empregamos a utilidade msgfmt ca que obtemos o ficheiro helloworld.mo. Se movemos o ficheiro o directorio adecuado (o que especificamos en \lstinline{textdomain()}) o noso programa xa estará localizado.

%http://www.gnu.org/software/libc/manual/html_node/Locating-gettext-catalog.html

\subsection{Ficheiros Gettext PO}
Como xa dixemos antes os ficheiros PO son os ficheiros que temos que editar para localizar o noso programa. Primeiro dicir que se trata ficheiros de texto plano e que polo tanto podemos editar con calquer editor de ficheiros de texto plano. Non obstante,

As súas principais características son:

\paragraph{Soporte de plurales}
Algo que pode parecer trivial como o soporte de plurales deixa de selo cando consideramos que non todos as linguaxes do mundo empregan dous plurales. A lingua eslovaca, por exemplo, conta con tres formas de plural de forma que o plural faise diferente para 1, 3 e 5 elementos.

Gettext representa a forma de plural de cada linguaxe con unha cadea da seguinte forma: $$nplurals=n; plural=exp;$$ Onde $n$ representa o número de plurais da linguaxe e $exp$ a expresión para calcular cando debemos empregar cada forma. Por exemplo a forma plural do galego representase como $nplurals=2; plural=(n != 1);$. Isto é que temos 2 plurales e que so se emprega a forma singular cando o número de elementos é igual a $1$.

No código fonte para que GetText escolla a tradución adecuada temos que empregar a función \lstinline{ngettext}. Esta función recive como parametros a cadea orixinal en singular, a cadea orixinal en plural e o número de elementos. No seguinte fragmento de código temos un exemplo:

\begin{lstlisting}[language=C,caption=Plurais en GetText (Código Fonte).]
[...]
    printf (ngettext ("We have %d car.", "We have %d cars.", n), n);
[...]
\end{lstlisting}

A cadea do ficheiro PO correspondente o código anterior podese ver no seguinte fragmento de código. Vemos como temos unha entrada \lstinline{msgstr} por cada plural. Desta forma o plural número $0$ corresponde os singular é o plural número $1$ correspondese coa primeira forma do plural.

\begin{lstlisting}[caption=Plurais en GetText (Ficheiro PO).]
#: helloworld.c:19
#, c-format
msgid "We have %d car."
msgid_plural "We have %d cars."
msgstr[0] "Temos %d coche."
msgstr[1] "Temos %d coches."
\end{lstlisting}


\paragraph {Marcado de traducións difusas}
Permitese marcar certas traducións como difusas de forma que o traductor indica qu enon está seguro de que dita tradución sexa correcta. Se marcasemos a tradución \emph{"Hello World!"} como difusa o ficheiro PO tería o seguinte aspecto:

\begin{lstlisting}[label=some-code,caption=Ficheiro POT con comentario.]
[...]
#: helloworld.c:15
#, c-format
#, fuzzy
msgid "Hello World!"
msgstr ""
[...]
\end{lstlisting}

\paragraph {Formato das traducións}
Os ficheiro po permite indicar se as cadeas a traducir teñen un formato determinado. Por exemplo a cadea do exemplo no Fragmento de Código \ref{lst:translated_example} podese ver que ten o flag \lstinline{c-format} debido a que é parte dunha sentencia printf e podería levar indicadores de formato da forma \lstinline{%s}.

\paragraph {Cabeceira con metadatos}
Exite unha cadea especial nos documentos Gettext PO. Trátase da cadea baleira que serve para almacenar metadatos do ficheiro. No fragmento de código \ref{lst:translated_example} podemos ver estos metadatos. Algúns dos metadatos existentes son:

\begin{itemize}
    \item \textbf{Project-Id-Version.} Nome único para o proxecto deste arquivo de tradución.
    \item \textbf{Report-Msgid-Bugs-To.} Ligazón onde reportar errores nas cadeas orixinais ou para pedir contexto para facer a tradución.
    \item \textbf{POT-Creation-Date.} Data de creación do ficheiro POT.
    \item \textbf{PO-Revision-Date.} Data da última actualización das traducións.
    \item \textbf{Last-Translator.} Nome e enderezo de correo electronico do último traductor.
    \item \textbf{Language-Team.} Enderezo de correo eléctronico do equipo de traductores.
    \item \textbf{Language.} Linguaxe do ficheiro expresada coa codificación ISO 639.
    \item \textbf{Content-Type.} Tipo MIME do ficheiro, que será sempre \lstinline{text/plain} e codificación dos caracteres.
    \item \textbf{Plural-Forms.} Expresión da forma plural empregada.
\end{itemize}

Ademais destes campos, nos comentarios, gardanse os nomes de todas as persoas que contribuiron a esta tradución.

\paragraph{Gardado dos orixes das cadeas}
Gettext almacena para cada cadea en que lugares do código aparece esta. O cal pode ser moi interesante para implentar a previsualización das traducións. Por exemplo no Fragmento de Código~\ref{lst:translated_example} vemos como a cadea \emph{"Hello World!"} pode atoparse na liña 14 do ficheiro \lstinline{helloworld.c}.

\paragraph{Comentarios dos programadores}
É unha función moi importante xa que en moitas ocasións nas linguaxes a mesma palabra empregase como verbo ou como nome polo que en ocasións é importante incorporar un contexto para esa tradución. Para facer isto é necesario simplemente poñer un comentario no programa antes de empregar a cadea. Por exemplo no seguinte fragmento de código:

\begin{lstlisting}[language=C,caption=Tradución con comentario.]
[...]
    // Translators: We are just waving the world.
    printf (_("Hello World!"));
[...]
\end{lstlisting}

Estamos engadindo un comentario a cadea \emph{"Hello World!"}. O ficheiro POT resultado tería a forma:

\begin{lstlisting}[label=some-code,caption=Ficheiro POT con comentario.]
[...]
#. Translators: We are just waving the world.
#: helloworld.c:15
#, c-format
msgid "Hello World!"
msgstr ""
[...]
\end{lstlisting}


\paragraph{Comentarios dos traductores}
A biblioteca permite que os traductores comenten as cadeas. Engadindo un comentario á cadea \emph{"Hello World!"}, o ficheiro PO tería o seguinte aspecto:

\begin{lstlisting}[caption=Ficheiro PO con comentario.]
[...]
# This is a note from translators.
#: helloworld.c:15
#, c-format
msgid "Hello World!"
msgstr ""
[...]
\end{lstlisting}

\section{Ferramentas CAT do mercado}

Nesta sección analizaremos algunhas das ferramentas de asistencia a tradución existentes. Veremos as características que incorporan estos programas así como estudiar a súa interface de usuario.

\subsection{GTranslator}
GTranslator é a aplicación oficial do proxecto GNOME para a asistencia a tradución. Este aplicativo so permite a tradución de arquivos GNU Gettext. As característica máis destacables deste programa son a posibilidade de abrir varios ficheiros en diferentes lapelas, soporte de memorias de tradución, perfiles para diferentes traductores, edición dos comentarios dos ficheiros .po e un sistema de plugins que permite extender a ferramenta.

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{img/captura_gtranslator.png}
    \caption[Interface de GTranslator]{Interface de GTranslator}
    \label{fig:gtranslator}
\end{figure}

En canto a interface, como podemos ver na Figura~\ref{fig:gtranslator}, a parte máis importante do programa é a a lista de mensaxes. Abaixo temos un panel onde se pode editar cada mensaxe e a dereita a memoria de tradución. A disposición dos elementos desta interface é configurable xa que permite mover e ampliar cada un dos módulos. O programa tamén incorpora atallos de teclado que permiten moverse polo documento e selecionar cada elemento da memoria de tradución.

Este programa pese a ser o aplicativo oficial de GNOME é moi pouco usado. As razóns disto son a ausencia dunha característica chave que o diferencie doutras ferramentas do mercado, a presencia de fallas importantes que afectan a usabilidade e a ausencia dun mantenedor que resolva estos problemas.

\subsection{Lokalize}
Lokalize é o programa oficial para o soporte a tradución en KDE. Foi escrita dende cero empregando a tecnoloxía de KDE Platform 4 e baseandose no código de KBabel. As súas carácteristicas máis destacables son, o soporte para ficheros GNU Gettext e o formato QT TS entre outros; a xestión de proxectos incorporando unha vista que permite ver un resumo de cada ficheiro dentro do proxecto; uso de memorias de tradución e de glosarios; comprobación da ortografía e vista previa das traducións a partir de scripts feitos polo usuario.

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{img/captura_lokalize.png}
    \caption{Interface de Lokalize}
    \label{fig:lokalize}
\end{figure}

En canto a interface, o programa permite abrir varios ficheiros cada un na súa lapela. Como se pode ver na Figura~\ref{fig:lokalize}, a vista de tradución está centrada no panel de edición, onde aparecen tanto a cadea orixinal como a cadea a traducir. Na columna da esquerda podemos ver a lista de cadeas onde se amosan os primeiros caracteres da cadea orixinal e da tradución e o estado desta tradución. Ademais tamén se pode ver o contexto da tradución, engadir un novo comentario e ver en que ficheiros estaba dita tradución. Por últimom tamén podemos ver na parte inforior a memoria de tradución e o glosario.

\subsection{Virtaal}

Virtaal é unha ferramenta CAT creada por Translate House. Compañia surxida a partir dunha comuindade de traductores de Sudafrica e que está especializada na creación de ferramentas e bibliotecas para axudar a tradución. As características máis destacables son a incorporación de suxestión a tradución, comprobación da calidade das tradución e, sobretodo, a capacidade de abrir unha gran variedade de formatos a través de Translate Toolkit.

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{img/captura_virtaal.png}
    \caption{Interface de Virtaal}
    \label{fig:virtaal}
\end{figure}

Como se pode ver na Figura~\ref{fig:virtaal}, a interface é minimalista e moi centrada na tradución. A diferencia dos casos anteriores, trátase dunha interface fixa e que integra a lista das mensaxes coa edición da propia mensaxe. Tamén se indican posibles fallos que poidan ter a tradución, como falta de puntos o final, ausencia de marcadores de formato, etc.

\subsection{OmegaT}

As súas principais características son o uso de meoria de tradución, glosario, tradución directa, uso doutras linguaxes entre outras cartacterísticas.

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{img/captura_omegat.png}
    \caption{Interface de OmegaT}
    \label{fig:omegat}
\end{figure}

A interface de OmegaT dista bastante do resto de programas. Como amosa a Figura~\ref{fig:omegat} non existe o concepto de lista de mensaxes traducir. O documento amosase como unha sucesión de cadea e se facemos click encima dunha, permitiranos traducila.


\subsection{Google Translation Toolkit}
É a ferramenta CAT desenvolvida por Google. É un aplicación online a diferencia dos anteriores. Entre as súas principais carácterísticas encontrase a posibilidade de facer tradución automática empregando Google Translator, o manexo de Memorias de Tradución,etc.

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{img/captura_googletranslationtoolkit.png}
    \caption{Interface de Google Translation Toolkit}
    \label{fig:translatetoolkit}
\end{figure}

\subsection{Transifex}
Tamén se trata dunha solución web. Neste caso de pago.

\begin{figure}[h]
    \centering
    \includegraphics[width=\textwidth]{img/captura_transifex.png}
    \caption{Interface de Transifex}
    \label{fig:transifex}
\end{figure}

\subsection{Outras ferramentas}
Existen moitas máis ferramentas CAT no mercado. De feito segun unha enquisa \cite{article:2006survey} elaborada polo Imperial College London a cerca de 900 traductores profesionais de 54 países diferentes, os unicos programas de todos os anteriores que aparecen citados é o OmegaT que conta con un 7\% de usuarios. As ferramentas máis usadas son ferramentas para MS Windows e ferramentas con licencias privativas e usualmente moi caras. Algunhas destas ferramentas son TRADOS, Wordfast, DejaVu SDLX ou STAR Transit. Na Figura~\ref{fig:enquisa2006} podemos ver unha gráfica coas ferramentas máis empregadas segun este estudio.

\begin{figure}[h]
    \centering
    \includegraphics[width=0.7\textwidth]{img/grafico_uso_cat_enquisa2006.png}
    \caption{Ferramentas CAT máis empregadas segundo \cite{article:2006survey}.}
    \label{fig:enquisa2006}
\end{figure}

Hai que ter tamén en conta que se trata dun estudio bastante antigo polo que algunhas das ferramentas analizadas aínda non existían. Por exemplo a enquisa cita a ferramenta KBabel, que é a ferramenta de KDE na que está basada Lokalize, pero con menos dun 2\% de usuarios.


\section{Carácteristicas xenericas das ferramentas CAT}

Algunhas das carácteristicas que aparecen de forma recurrente en todas as ferramentas analizadas son as seguintes:

\subsection{Memoria de Tradución}
A memoria de tradución é unha base de datos de traducións xa feitas con anterioridade. A idea é que a partir desta base de datos obteñamos suxestións as traducións. Estas suxestións non teñen por que ser coincidencias ao 100\%. Existen ademais servidore de memoria de tradución que almacenan unha gran cantidade de traducións.

\subsection{Glosario}

\subsection{Previsualización}

\subsection{Tradución Directa}
A tradución das cadeas de forma automatica empregando ferramentas como Google Translate.